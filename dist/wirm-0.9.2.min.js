/* ============================================ 
 * wirm.js v0.9.2 
 * http://walkerjeffd.github.com/wirm/ 
 * ============================================= 
 * Copyright 2013 Jeffrey D. Walker 
 * 
 * Build Date: 2013-06-23 
 * ============================================= */ 
function getCookie(a){var b=null;if(document.cookie&&""!==document.cookie)for(var c=document.cookie.split(";"),d=0;d<c.length;d++){var e=jQuery.trim(c[d]);if(e.substring(0,a.length+1)==a+"="){b=decodeURIComponent(e.substring(a.length+1));break}}return b}window.oldSync=Backbone.sync,Backbone.sync=function(a,b,c){return c.beforeSend=function(a){a.setRequestHeader("X-CSRFToken",getCookie("csrftoken"))},window.oldSync(a,b,c)},window.App={Models:{},Collections:{},Views:{},Router:{}},App.vent=_.extend({},Backbone.Events),App.template=function(a){return _.template($("#"+a).html())},Backbone.View.prototype.close=function(){this.subViews&&_.each(this.subViews,function(a){a.close()}),this.onClose&&this.onClose(),this.remove(),this.unbind(),this.stopListening()},App=window.App||{},App.SimulationEngine=function(a){var b=a.L_0,c=a.o_0,d=a.T,e=a.x_max,f=a.U,g=a.H,h=a.k_d_20,i=a.k_so,j=a.theta_BOD,k=a.theta_DO,l=function(a){var b=a+273.15;return Math.exp(-139.34411+157570.1/b-66423080/Math.pow(b,2)+12438e6/Math.pow(b,3)-8621949e5/Math.pow(b,4))},m=function(a,b){return.61>=a?5.32*Math.pow(b,.67)*Math.pow(a,-1.85):a>4.145*Math.pow(b,2.711)?3.93*Math.pow(b,.5)*Math.pow(a,-1.5):5.026*Math.pow(b,.969)*Math.pow(a,-1.673)},n=function(a,b){return a/Math.max(b+a,.001)},o=l(d),p=m(g,f),q=p*Math.pow(k,d-20),r=h*Math.pow(j,d-20),s=[0,e/(86.4*f)],t=.1,u=[b,c],v=function(a,b){var c=b[0],d=b[1],e=n(d,i),f=-e*r*c,g=-e*r*c+q*(o-d);return[f,g]},w=function(a,b,c){for(var d=a[0],e=[d],f=b,g=[f];d+t<=a[1];)K1=numeric.mul(t,c(d,f)),K2=numeric.mul(t,c(d+t/2,numeric.add(f,numeric.mul(.5,K1)))),K3=numeric.mul(t,c(d+t/2,numeric.add(f,numeric.mul(.5,K2)))),K4=numeric.mul(t,c(d+t,numeric.add(f,K3))),Ksum=numeric.add(numeric.add(numeric.add(K1,numeric.mul(2,K2)),numeric.mul(2,K3)),K4),f=numeric.add(f,numeric.mul(1/6,Ksum)),d+=t,e.push(d),g.push(f);return{t:e,y:g}},x=w(s,u,v),y={key:"BOD",geom:"line",data:d3.zip(x.t.map(function(a){return a*86.4*f}),x.y.map(function(a){return a[0]}))},z={key:"DO",geom:"line",data:d3.zip(x.t.map(function(a){return a*86.4*f}),x.y.map(function(a){return a[1]}))},A={key:"DO_sat",geom:"line",color:"black",dashed:!0,data:[[0,o],[86.4*x.t[x.t.length-1]*f,o]]};return[y,z,A]},App=window.App||{},App.Chart=function(){function a(a){o.range([0,k-j.left-j.right]).domain([0,1]),p.range([l-j.top-j.bottom,0]).domain([0,1]),i=d3.select(a).append("svg").attr("width",k).attr("height",l);var b=i.append("g").attr("transform","translate("+j.left+","+j.top+")");q.scale(o).orient("bottom"),r.scale(p).orient("left"),b.append("g").attr("class","x axis").attr("transform","translate(0,"+p.range()[0]+")").call(q).append("text").attr("transform","translate("+(k-j.left-j.right)/2+",0)").attr("y",6).attr("dy","2em").style("text-anchor","middle").text(f),b.append("g").attr("class","y axis").call(r).append("text").attr("transform","translate(0,"+(l-j.top-j.bottom)/2+")rotate(-90)").attr("y",6).attr("dy","-3em").style("text-anchor","middle").text(g),b.append("g").attr("class","lines"),b.append("g").attr("class","points"),h=i.append("g").attr("class","legend").attr("transform","translate("+j.left+","+j.top/2+")")}function b(a){return o(a[0])}function c(a){return p(a[1])}var d,e,f,g,h,i,j={top:40,right:20,bottom:40,left:50},k=500,l=500,m=function(a){return a[0]},n=function(a){return a[1]},o=d3.scale.linear(),p=d3.scale.linear(),q=d3.svg.axis(),r=d3.svg.axis(),s=d3.scale.category10(),t=d3.svg.line().x(b).y(c);return a.width=function(b){return arguments.length?(k=b,a):k},a.height=function(b){return arguments.length?(l=b,a):l},a.x=function(b){return arguments.length?(m=b,a):m},a.y=function(b){return arguments.length?(n=b,a):n},a.color=function(b){return arguments.length?(s&&(s=b),a):s},a.xDomain=function(b){return arguments.length?(d=b,a):d},a.yDomain=function(b){return arguments.length?(e=b,a):e},a.xLabel=function(b){return arguments.length?(f=b,a):f},a.yLabel=function(b){return arguments.length?(g=b,a):g},a.data=function(b){var c={lines:b.filter(function(a){return"line"==a.geom}),points:b.filter(function(a){return"point"==a.geom})};if(d)o.domain(d);else{var f=d3.max(c.points.map(function(a){return m(a.data)})),g=d3.max(d3.merge(c.lines.map(function(a){return a.data.map(m)})));o.domain([0,d3.max([f,g])]).nice()}if(e)p.domain(e);else{var j=d3.max(c.points.map(function(a){return n(a.data)})),k=d3.max(d3.merge(c.lines.map(function(a){return a.data.map(n)})));p.domain([0,d3.max([j,k])]).nice()}return i.select("g.x.axis").call(q),i.select("g.y.axis").call(r),circles=i.select("g.points").selectAll("circle").data(c.points),circles.enter().append("circle"),circles.attr("cx",function(a){return o(m(a.data))}).attr("cy",function(a){return p(n(a.data))}).attr("r",10).attr("fill","red"),circles.exit().remove(),lines=i.select("g.lines").selectAll("path").data(c.lines),lines.enter().append("path").attr("d",function(a){return t(a.data)}).style("stroke-dasharray",function(a){return a.dashed?"3, 3":"1, 0"}).style("stroke",function(a){return a.color||s(a.key)}),lines.attr("d",function(a){return t(a.data)}),lines.exit().remove(),h.selectAll("line").data(c.lines).enter().append("line").attr("x1",function(a,b){return o.range()[1]-80*(b+1)}).attr("x2",function(a,b){return o.range()[1]-80*(b+1)+15}).attr("y1",.5).attr("y2",.5).style("stroke-dasharray",function(a){return a.dashed?"3, 3":"1, 0"}).style("stroke",function(a){return a.color||s(a.key)}),h.selectAll("text").data(c.lines).enter().append("text").attr("x",function(a,b){return o.range()[1]-80*(b+1)+20}).attr("y",4.5).attr("text-anchor","start").text(function(a){return a.key}),a},a},App.Models.Comment=Backbone.Model.extend({}),App.Models.Parameter=Backbone.Model.extend({urlRoot:"/api/parameters/",saveRevert:function(){this._revertAttributes=_.clone(this.attributes)},revert:function(){this._revertAttributes?this.set(this._revertAttributes):console.log("ERROR: Unable to revert parameter, cannot find cached values")}}),App.Models.Project=Backbone.Model.extend({urlRoot:"/api/projects/",defaults:{title:"New Project",location:"",description:"",parameter_values:"",owner:null,comments:[]},validate:function(a){return""===a.title.trim()?"Project title cannot be blank":""===a.location.trim()?"Project location cannot be blank":""===a.description.trim()?"Project description cannot be blank":void 0},save:function(a,b){var c=this,d=["comments"];_.each(d,function(a){c.unset(a)}),Backbone.Model.prototype.save.call(this,a,b)}}),App.Collections.Comments=Backbone.Collection.extend({model:App.Models.Comment,url:function(){return this.project.url()+"/comments/"},initialize:function(a,b){this.project=b.project}}),App.Collections.Parameters=Backbone.Collection.extend({model:App.Models.Parameter,url:"/api/parameters/",initialize:function(){App.vent.bind("reset:parameters",this.revert,this),App.vent.bind("save:parameters",this.saveRevert,this)},saveRevert:function(){console.log("parameters: saving parameter state"),this.each(function(a){a.saveRevert()})},revert:function(){console.log("parameters: reverting parameter state"),this.each(function(a){a.revert()})},getKeyValuePairs:function(){var a={};return this.each(function(b){a[b.get("key")]=b.get("value")}),a}}),App.Collections.Projects=Backbone.Collection.extend({model:App.Models.Project,url:"/api/projects/"}),App.Views.Chart=Backbone.View.extend({initialize:function(a){console.log("INIT: chart");var b=this;this.engine=a.engine,this.parameters=a.parameters,this.rendered=!1,this.chart=new App.Chart,_.each(this.options.chartOptions,function(a,c){b.chart[c](a)}),this.listenTo(this.parameters,"change:value",this.update)},render:function(){return console.log("RENDER: chart"),this.chart(this.el),this.rendered=!0,this},update:function(){return console.log("UPDATE: chart"),this.rendered&&this.chart.data(this.engine(this.parameters.getKeyValuePairs())),this},onClose:function(){console.log("CLOSE: chart view")}}),App.Views.CommentTab=Backbone.View.extend({template:App.template("template-comment"),events:{"click #submit-comment":"submitComment"},initialize:function(){console.log("INIT: comment tab"),this.listenTo(this.collection,"sync",this.render,this),this.listenTo(this.collection,"change",this.render,this),this.listenTo(this.collection,"remove",this.render,this),this.listenTo(this.collection,"add",this.render,this),this.listenTo(this.collection,"reset",this.render,this)},render:function(){console.log("RENDER: comment tab");var a=this;if(a.$el.html(this.template()),this.collection.isEmpty())this.$(".comment-list-container").html("<p>No comments</p>");else{var b=new App.Views.CommentList({collection:this.collection});this.$(".comment-list-container").html(b.render().el)}return this},submitComment:function(a){a.preventDefault();var b=this.$("input[name='comment']").val();this.collection.create({comment:b},{wait:!0,success:function(){this.$("input[name='comment']").val(""),console.log("added comment")},error:function(a,b){this.$("input[name='comment']").val(""),App.vent.trigger("status","error","Unable to save comment"),console.log(b)}})}}),App.Views.CommentList=Backbone.View.extend({tagName:"ul",className:"comment-list",initialize:function(){console.log("INIT: comment list")},render:function(){console.log("RENDER: comment list");var a=this;return a.$el.empty(),this.collection.isEmpty()?this.$el.html("No comments"):this.collection.each(function(b){var c=new App.Views.CommentListItem({model:b});a.$el.append(c.render().el)}),this}}),App.Views.CommentListItem=Backbone.View.extend({tagName:"li",className:"comment-item",template:App.template("template-comment-item"),events:{"click .btn-delete":"deleteComment"},initialize:function(){},render:function(){var a=this.model.toJSON();return a.formatCreated=moment(a.created).fromNow(),this.$el.html(this.template(a)),this},deleteComment:function(){this.model.destroy({wait:!0,success:function(){App.vent.trigger("status","success","Comment deleted")},error:function(){App.vent.trigger("status","error","Unable to delete comment")}})}}),App.Views.Controls=Backbone.View.extend({template:App.template("template-controls"),events:{"click .btn-save":"saveProject","click .btn-reset":"resetParameters","click .btn-share":"shareProject"},initialize:function(a){console.log("INIT: controls"),this.project=a.project,this.parameters=a.parameters,App.vent.bind("status",this.showStatus,this)},render:function(){return console.log("RENDER: controls"),this.$el.html(this.template()),this.project.isNew()?(this.$(".btn-share").hide(),this.$(".btn-save").tooltip({placement:"bottom",trigger:"hover",container:"body",title:"Save to new project"}),this.$(".btn-reset").tooltip({placement:"bottom",trigger:"hover",container:"body",title:"Reset parameters to default values"})):(this.$(".btn-share").tooltip({placement:"bottom",trigger:"hover",container:"body",title:"Share saved project with others"}),this.$(".btn-save").tooltip({placement:"bottom",trigger:"hover",container:"body",title:"Save project to server"}),this.$(".btn-reset").tooltip({placement:"bottom",trigger:"hover",container:"body",title:"Reset parameters to last saved values"})),this.$(".alert").hide(),this},onClose:function(){console.log("CLOSE: controls")},saveProject:function(){console.log("controls: save project"),this.project.isNew()?App.router.isAuthenticated()?new App.Views.ProjectModal({project:this.project,parameters:this.parameters,parent:this}):App.vent.trigger("status","error",'Error: You must <a href="/accounts/login/">log in</a> first to save a new project',5e3):App.user===this.project.get("owner").username?this.project.save({parameter_values:this.parameters.getKeyValuePairs()},{success:function(){App.vent.trigger("status","success","Success: Project saved"),App.vent.trigger("save:parameters")},error:function(){App.vent.trigger("status","error","Error: unable to save project parameter values")}}):App.vent.trigger("status","error","Error: Only the owner of this project can save changes")},showStatus:function(a,b,c){c=c||3e3,this.$(".alert").clearQueue(),this.$(".alert").removeClass().addClass("alert alert-"+a),this.$("#status").html(b),this.$(".alert").show(0),this.$(".alert").delay(c).fadeOut()},resetParameters:function(){console.log("controls: reset parameters"),App.vent.trigger("reset:parameters")},shareProject:function(){console.log("Sharing project "+this.project.get("id"));var a=new App.Views.ShareModal;a.render()}}),App.Views.ShareModal=Backbone.View.extend({template:App.template("template-share"),events:{"click .close":"close","click .btn-close":"close"},initialize:function(){console.log("INIT: share modal")},render:function(){return console.log("RENDER: share modal"),this.$el.html(this.template({url:location.href})),$("body").append(this.el),this.$(".modal").modal(),this},onClose:function(){console.log("CLOSE: share modal"),this.$(".modal").modal("hide")}}),App.Views.Dashboard=Backbone.View.extend({template:App.template("template-dashboard"),initialize:function(){console.log("INIT: dashboard"),this.parameters=this.options.parameters,this.project=this.options.project,this.comments=this.options.comments,this.subViews={},this.project.isNew()||(this.subViews.projectInfo=new App.Views.ProjectInfo({project:this.project,parameters:this.parameters})),this.subViews.controls=new App.Views.Controls({project:this.project,parameters:this.parameters}),this.subViews.tabsView=new App.Views.Tabs({project:this.project,parameters:this.parameters,comments:this.comments}),this.subViews.chartView=new App.Views.Chart({chartOptions:{width:500,height:400,color:d3.scale.category10(),xLabel:"Distance Downstream (km)",yLabel:"Concentration (mg/L)"},parameters:this.parameters,engine:App.SimulationEngine})},render:function(){return console.log("RENDER: dashboard"),this.$el.html(this.template()),this.project.isNew()?this.$("#project-info").html("<h1>New Project</h1>"):this.$("#project-info").html(this.subViews.projectInfo.render().el),this.$("#controls").html(this.subViews.controls.render().el),this.$("#chart-container").html(this.subViews.chartView.render().update().el),this.$("#tabs-container").html(this.subViews.tabsView.render().el),this},onClose:function(){console.log("CLOSE: dashboard")}}),App.Views.Error=Backbone.View.extend({template:App.template("template-error"),initialize:function(a){this.title=a.title,this.message=a.message},render:function(){return this.$el.html(this.template({title:this.title,message:this.message})),this}}),App.Views.ParametersTab=Backbone.View.extend({initialize:function(a){console.log("INIT: parameters view"),this.parameters=a.parameters,this.group=a.group},render:function(){console.log("RENDER: parameters view");var a=this;this.$el.empty();var b=this.parameters.filter(function(b){return b.get("group")===a.group});return _.each(b,function(b){var c=new App.Views.ParameterContainer({model:b});a.$el.append(c.el)}),this},onClose:function(){console.log("CLOSE: parameters tab - "+this.group)}}),App.Views.ParameterContainer=Backbone.View.extend({className:"param-row",initialize:function(){console.log("INIT: container for "+this.model.get("key")),this.parameterLabel=new App.Views.ParameterLabel({model:this.model}),this.parameterSlider=new App.Views.ParameterSlider({model:this.model}),this.render()},render:function(){return this.$el.empty(),this.$el.append(this.parameterLabel.render().el),this.$el.append(this.parameterSlider.render().el),this}}),App.Views.ParameterLabel=Backbone.View.extend({className:"param-label",template:App.template("template-parameter-label"),initialize:function(){this.listenTo(this.model,"change:value",this.render)},render:function(){return this.$el.html(this.template(this.model.toJSON())),this}}),App.Views.ParameterSlider=Backbone.View.extend({className:"slider param-slider",events:{slide:"slideUpdate"},initialize:function(){this.$el.slider(this.model.toJSON());var a=this.model.get("max"),b=this.model.get("min");this.$el.slider("option","step",Math.pow(10,Math.round(Math.log(a-b)/Math.log(10))-2)),this.listenTo(this.model,"change:value",this.render)},slideUpdate:function(a,b){this.model.set("value",b.value)},render:function(){return this.$el.slider(this.model.toJSON()),this}}),App.Views.ProjectInfo=Backbone.View.extend({template:App.template("template-project-info"),events:{"click .btn-edit":"editProject","click .btn-delete":"deleteProject","click .alert .btn-confirm":"deleteProjectConfirm","click .alert .btn-cancel":"deleteProjectCancel"},initialize:function(a){console.log("INIT: project info"),this.project=a.project,this.parameters=a.parameters,this.listenTo(this.project,"sync",this.render,this),this.listenTo(this.project,"destroy",function(){App.router.navigate("/",{trigger:!0})})},render:function(){return console.log("RENDER: project info"),this.$el.html(this.template(this.project.toJSON())),this.$(".alert").hide(),this},onClose:function(){console.log("CLOSE: project info")},editProject:function(){console.log("controls: edit project "+this.project.get("id")),App.user===this.project.get("owner").username?new App.Views.ProjectModal({project:this.project,parameters:this.parameters,title:"Edit Project Info"}):App.vent.trigger("status","error","Error: Only the owner of this project can edit it")},deleteProjectConfirm:function(){this.project.destroy()},deleteProjectCancel:function(){this.$(".alert").toggle()},deleteProject:function(){console.log("controls: delete project "+this.project.get("id")),App.user===this.project.get("owner").username?this.$(".alert").slideDown():App.vent.trigger("status","error","Error: Only the owner of this project can delete it")}}),App.Views.ProjectListContainer=Backbone.View.extend({template:App.template("template-project-container"),initialize:function(){console.log("INIT: project list container"),this.subViews={},this.subViews.projectList=new App.Views.ProjectList({collection:this.collection})},render:function(){console.log("RENDER: project list container"),this.$el.html(this.template()),App.router.isAuthenticated()?this.collection.isEmpty()?this.$el.append('<p>You have no saved projects. <a href="#">Click here</a> to start a new project</p>'):this.$el.append(this.subViews.projectList.render().el):this.$el.append('<p>You must be logged in to view saved projects. Click here to <a href="/accounts/login/">log in</a> or <a href="/accounts/register/">sign up</a>.</p>')},onClose:function(){console.log("CLOSE: project list container")}}),App.Views.ProjectList=Backbone.View.extend({tagName:"ul",className:"project-list",initialize:function(){console.log("INIT: project list"),this.subViews=[]},render:function(){console.log("RENDER: project list");var a=this;return this.$el.empty(),this.collection.each(function(b){var c=new App.Views.ProjectListItem({model:b});a.subViews.push(c),a.$el.append(c.render().el)}),this},onClose:function(){console.log("CLOSE: project list")}}),App.Views.ProjectListItem=Backbone.View.extend({tagName:"li",className:"project-item",model:App.Models.Project,template:App.template("template-project-item"),events:{"click .btn-delete":"deleteProject"},initialize:function(){console.log("INIT: project list item for id "+this.model.get("id"))},render:function(){console.log("RENDER: project list item");var a=this.model.toJSON(),b=this;return a.created=moment(a.created).format("MMM D YYYY h:mm a"),a.updated=moment(a.updated).format("MMM D YYYY h:mm a"),a.createdFromNow=moment(a.created).fromNow(),a.updatedFromNow=moment(a.updated).fromNow(),this.$el.html(this.template(a)),this.$(".alert").hide(),this.$(".alert .btn-confirm").on("click",function(){b.model.destroy(),b.close()}),this.$(".alert .btn-cancel").on("click",function(){b.$(".alert").toggle()}),this},deleteProject:function(){this.$(".alert").slideDown()},onClose:function(){console.log("CLOSE: project list item for id "+this.model.get("id"))}}),App.Views.ProjectModal=Backbone.View.extend({template:App.template("template-project-modal"),events:{"click .btn-save":"saveProject","click .close":"close","click .btn-close":"close"},initialize:function(a){console.log("INIT: project modal"),this.project=a.project,this.parameters=a.parameters,this.title=a.title||"Create Project",this.project.set("parameter_values",this.parameters.getKeyValuePairs()),this.listenTo(this.project,"sync",this.postSave,this),this.listenTo(this.project,"error",this.showError),this.listenTo(this.project,"invalid",this.showInvalid),this.render()},render:function(){return console.log("RENDER: project modal"),this.$el.html(this.template(this.project.toJSON())),this.$("#projectModalLabel").text(this.title),$("body").append(this.el),this.$(".alert").hide(),this.$(".modal").modal(),this},saveProject:function(){console.log("project modal: saving project"),this.project.save({title:this.$("input[name='title']").val(),location:this.$("input[name='location']").val(),description:this.$("textarea[name='description']").val()},{wait:!0})},postSave:function(){console.log("SUCCESS: project saved"),App.vent.trigger("status","success","Project saved"),this.close(),App.router.navigate("/projects/"+this.project.get("id"),{trigger:!0})},onClose:function(){console.log("CLOSE: project modal"),this.$(".modal").modal("hide")},showError:function(a,b){console.log("ERROR: unable to save project"),this.showStatus("Error: Unable to save model."),console.log(b)},showInvalid:function(a,b){this.showStatus("Error: "+b),console.log("Invalid model: "+b)},showStatus:function(a){this.$(".alert").clearQueue(),this.$(".alert").html(a),this.$(".alert").show()}}),App.Views.Tabs=Backbone.View.extend({template:App.template("template-tabs"),initialize:function(a){console.log("INIT: tabs"),this.parameters=a.parameters,this.project=a.project,this.comments=a.comments,this.subViews={},this.subViews.basicTab=new App.Views.ParametersTab({parameters:this.parameters,group:"basic"}),this.subViews.advancedTab=new App.Views.ParametersTab({parameters:this.parameters,group:"advanced"}),this.comments&&(this.subViews.commentTab=new App.Views.CommentTab({collection:this.comments}))},render:function(){return console.log("RENDER: tabs"),this.$el.html(this.template()),this.$("#tab-param-basic").html(this.subViews.basicTab.render().el),this.$("#tab-param-advanced").html(this.subViews.advancedTab.render().el),this},onClose:function(){console.log("CLOSE: tabs")}}),App.Router.Workspace=Backbone.Router.extend({routes:{"":"newProject",projects:"projectList","projects/:id":"loadProject","*path":"unknownPath"},initialize:function(a){this.el=a.el},showView:function(a){this.currentView&&this.currentView.close(),this.currentView=a,this.currentView.render(),$(this.el).html(this.currentView.el)},newProject:function(){console.log("ROUTE: new project");var a=this,b=new App.Models.Project,c=new App.Collections.Parameters,d=new App.Views.Dashboard({parameters:c,project:b});c.fetch({success:function(b){b.saveRevert(),a.showView(d)},error:function(b,c){a.showError("Error Fetching Default Parameters","Server responded with status "+c.status+": "+c.statusText+".")}})},projectList:function(){console.log("ROUTE: project list");var a=this;projects=new App.Collections.Projects,projectListView=new App.Views.ProjectListContainer({collection:projects}),projects.fetch({success:function(){a.showView(projectListView)},error:function(b,c){a.showError("Error Fetching Project List","Server responded with status "+c.status+": "+c.statusText+".")}})},loadProject:function(a){console.log("ROUTE: load project");var b=this,c=new App.Models.Project({id:a}),d=new App.Collections.Parameters,e=new App.Collections.Comments([],{project:this.project}),f=new App.Views.Dashboard({parameters:d,project:c,comments:e});d.fetch({success:function(){c.fetch({success:function(){var a=c.get("parameter_values");d.each(function(b){b.set("value",a[b.get("key")])}),App.vent.trigger("save:parameters"),b.showView(f)},error:function(c,d){console.log("ERROR: fetching project "+a),404===d.status?b.showError("Project Not Found","The project with id "+a+" was not found by the server."):b.showError("Error Fetching Project","Server responded with status "+d.status+": "+d.statusText+".")}})},error:function(a,c){console.log("ERROR: fetching parameters"),b.showError("Error Fetching Default Parameters","Server responded with status "+c.status+": "+c.statusText+".")}})},postProjectSync:function(){console.log("workspace: updating parameters"),this.comments.fetch()},showError:function(a,b){errorView=new App.Views.Error({title:a,message:b}),errorView.setElement(this.el).render()},unknownPath:function(a){this.showError("Unknown Path","The URL path #"+a+" in invalid.")},isAuthenticated:function(){return null!==App.user}}),App.boot=function(a){a=$(a),App.router=new App.Router.Workspace({el:a}),Backbone.history.start({root:"/client/"})};